<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title th:text="${chapter != null ? chapter.title : 'Reader'}">Reader</title>
    <link rel="stylesheet" th:href="@{/css/style.css}">
</head>

<body class="reader-mode">

    <!-- Reader Toolbar -->
    <header class="toolbar">
        <div class="toolbar-inner">
            <a href="/docs/stories" class="brand">‚Üê Library</a>

            <div class="controls">
                <!-- Work Mode Toggle -->
                <button class="control-btn" onclick="toggleWorkMode()" id="workModeBtn" title="Stealth Mode">
                    üíº Work Mode
                </button>

                <!-- Theme Switcher -->
                <div class="control-group" role="group" aria-label="Theme Selection">
                    <button class="control-btn active" onclick="setTheme('light')"
                        aria-label="Light Theme">Light</button>
                    <button class="control-btn" onclick="setTheme('sepia')" aria-label="Sepia Theme">Sepia</button>
                    <button class="control-btn" onclick="setTheme('gray')" aria-label="Gray Theme">Gray</button>
                    <button class="control-btn" onclick="setTheme('dark')" aria-label="Dark Theme">Dark</button>
                </div>

                <!-- Font Size Controls -->
                <div class="control-group" role="group" aria-label="Font Size">
                    <button class="control-btn" onclick="adjustFontSize(-2)" aria-label="Decrease Font Size">A‚àí</button>
                    <button class="control-btn" onclick="adjustFontSize(2)" aria-label="Increase Font Size">A+</button>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Reading Area -->
    <main class="reader-container" id="mainContainer">

        <!-- Fake Sidebar Left -->
        <aside class="sidebar-left">
            <div class="sidebar-title">Project Structure</div>
            <ul class="sidebar-list">
                <li><a href="#">Introduction</a></li>
                <li><a href="#">Getting Started</a></li>
                <li><a href="#" class="active-item">Architecture Overview</a></li>
                <li><a href="#">Authentication</a></li>
                <li><a href="#">API Endpoints</a></li>
                <li><a href="#">Database Schema</a></li>
            </ul>
            <div class="sidebar-title">Configuration</div>
            <ul class="sidebar-list">
                <li><a href="#">Environment Variables</a></li>
                <li><a href="#">Docker Setup</a></li>
                <li><a href="#">CI/CD Pipelines</a></li>
            </ul>
            <div class="sidebar-title">Security Module</div>
            <ul class="sidebar-list">
                <li><a href="#">OAuth2 Implementation</a></li>
                <li><a href="#">Role Based Access</a></li>
                <li><a href="#">Audit Logging</a></li>
                <li><a href="#">Encryption Standards</a></li>
            </ul>
            <div class="sidebar-title">Infrastructure</div>
            <ul class="sidebar-list">
                <li><a href="#">AWS CloudFormation</a></li>
                <li><a href="#">Kubernetes Manifests</a></li>
                <li><a href="#">Load Balancing</a></li>
                <li><a href="#">Disaster Recovery</a></li>
            </ul>
        </aside>

        <article>
            <header>
                <div class="confidential-badge">Confidential</div>
                <h1 th:text="${chapter != null ? chapter.title : 'Chapter Title'}">Chapter Title</h1>
                <div class="meta-info">
                    <span th:if="${story != null}" th:text="${story.name}">Story Name</span>
                    <span th:if="${chapterIndex != null}"> ‚Ä¢ Section <span th:text="${chapterIndex}">1</span></span>
                </div>
            </header>

            <!-- Content -->
            <div class="chapter-content" id="chapter-text" th:if="${chapter != null and chapter.content != null}">
                <div th:utext="${chapter.content}">
                    <p>Lorem ipsum dolor sit amet...</p>
                </div>
            </div>

            <div th:if="${chapter == null}" class="chapter-content">
                <p>No content available.</p>
            </div>

            <!-- Navigation Footer -->
            <nav class="story-nav">
                <a th:if="${previousChapter != null}"
                    th:href="@{/docs/stories/{storyId}/chapters/{chapterId}(storyId=${story.id}, chapterId=${previousChapter.id})}"
                    class="nav-link">‚Üê Previous</a>
                <span th:if="${previousChapter == null}" class="nav-link disabled">‚Üê Previous</span>

                <a th:if="${nextChapter != null}"
                    th:href="@{/docs/stories/{storyId}/chapters/{chapterId}(storyId=${story.id}, chapterId=${nextChapter.id})}"
                    class="nav-link">Next ‚Üí</a>
                <span th:if="${nextChapter == null}" class="nav-link disabled">Next ‚Üí</span>
            </nav>

        </article>

        <!-- Fake Sidebar Right -->
        <aside class="sidebar-right">
            <div class="sidebar-title">On this page</div>
            <ul class="sidebar-list">
                <li><a href="#">Summary</a></li>
                <li><a href="#">Specifications</a></li>
                <li><a href="#">Implementation Details</a></li>
                <li><a href="#">Dependencies</a></li>
                <li><a href="#">Risk Assessment</a></li>
            </ul>
            <div class="sidebar-title">Related Pages</div>
            <ul class="sidebar-list">
                <li><a href="#">Frontend Guidelines</a></li>
                <li><a href="#">Backend API V2</a></li>
                <li><a href="#">Legacy Migration</a></li>
            </ul>
            <div class="sidebar-title">Contributors</div>
            <div class="page-meta-list">
                <div style="font-size: 13px; color: var(--ui-text); margin-bottom: 8px;">Created by <br><strong>Admin
                        User</strong></div>
                <div style="font-size: 13px; color: var(--ui-text);">Last updated <br><strong>Today</strong></div>
            </div>
            <div style="margin-top: 2rem;">
                <a href="#" style="font-size: 13px; color: var(--link-color);">‚¨á Export to PDF</a>
            </div>
        </aside>

    </main>

    <script>
        // Reader Logic
        const body = document.body;
        const mainContainer = document.getElementById('mainContainer');
        const buttons = document.querySelectorAll('[onclick^="setTheme"]');
        const workModeBtn = document.getElementById('workModeBtn');

        // Font Size State
        let currentFontSize = 20;

        // Initialize from localStorage
        function initReader() {
            const savedTheme = localStorage.getItem('readerTheme') || 'light';
            const savedSize = localStorage.getItem('readerFontSize');
            const savedWorkMode = localStorage.getItem('readerWorkMode') === 'true';

            setTheme(savedTheme, false);

            if (savedSize) {
                currentFontSize = parseInt(savedSize);
                applyFontSize();
            }

            if (savedWorkMode) {
                toggleWorkMode(false);
            }
        }

        // Work Mode Logic
        function toggleWorkMode(save = true) {
            body.classList.toggle('work-mode');
            mainContainer.classList.toggle('work-mode-layout');

            const isActive = body.classList.contains('work-mode');

            if (isActive) {
                workModeBtn.classList.add('active');
                workModeBtn.textContent = 'Reading Mode';
                // Theme is now preserved/selectable
            } else {
                workModeBtn.classList.remove('active');
                workModeBtn.textContent = 'üíº Work Mode';
                // Restore user theme
                const savedTheme = localStorage.getItem('readerTheme') || 'light';
                setTheme(savedTheme, false);
            }

            if (save) localStorage.setItem('readerWorkMode', isActive);
        }

        // Theme Switcher
        function setTheme(themeName, save = true) {
            // Set Attribute
            if (themeName === 'light') {
                body.removeAttribute('data-theme');
            } else {
                body.setAttribute('data-theme', themeName);
            }

            // Update Buttons
            buttons.forEach(btn => {
                const label = btn.getAttribute('aria-label').toLowerCase();
                if (label.includes(themeName)) {
                    btn.classList.add('active');
                } else {
                    btn.classList.remove('active');
                }
            });

            if (save) localStorage.setItem('readerTheme', themeName);
        }

        // Font Size Adjustment
        function adjustFontSize(delta) {
            currentFontSize += delta;

            // Clamp between 18px and 26px (extended range for flexibility)
            if (currentFontSize < 16) currentFontSize = 16;
            if (currentFontSize > 28) currentFontSize = 28;

            applyFontSize();
            localStorage.setItem('readerFontSize', currentFontSize);
        }

        function applyFontSize() {
            body.style.fontSize = currentFontSize + 'px';
        }

        // Run Init
        initReader();
    </script>
</body>

</html>